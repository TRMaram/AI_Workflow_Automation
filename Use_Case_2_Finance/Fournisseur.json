{
  "name": "Fournisseur",
  "nodes": [
    {
      "parameters": {
        "public": true,
        "initialMessages": "Hi!  How can I help you today?”",
        "options": {
          "loadPreviousSession": "memory",
          "responseMode": "lastNode"
        }
      },
      "id": "7c891e79-1cef-4293-be80-4a11b8817a32",
      "name": "When chat message received",
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "position": [
        100,
        0
      ],
      "webhookId": "1de1a4dd-cea5-4c95-b489-6004601ff727",
      "typeVersion": 1.1
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1",
          "cachedResultName": "gpt-4.1"
        },
        "options": {
          "maxTokens": 1024,
          "temperature": 0.3
        }
      },
      "id": "29ad4820-f321-42af-91af-ae1d02ed4597",
      "name": "OpenAI Chat Model",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "position": [
        520,
        240
      ],
      "typeVersion": 1.2,
      "credentials": {
        "openAiApi": {
          "id": "dYZWfaOXMEhGY7FU",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {},
      "id": "99b3ec02-9215-45e8-ba65-c302297ddf1b",
      "name": "Simple Memory",
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "position": [
        140,
        360
      ],
      "typeVersion": 1.3
    },
    {
      "parameters": {
        "options": {
          "systemMessage": "=SYSTEM\nYou are SmartContract AI — an expert in contract automation, specialized in interpreting CFP (Call for Proposal) emails. When a new CFP email is received, you automatically initiate a guided, professional chat to gather all required contract parameters, reason through business and legal requirements, and generate a tailored supply contract proposal based on the CFP and the data inputed by the user.\n\nTOOLS\n• GetLatestCFPEmail  \n  → Returns: { \"cfp_text\": string, \"company_name\": string, \"requirements\": object }\n• SendProposal\n→ Parameters: { \"recipient_email\": string, \"contract_text\": string }\n→ Sends the finalized contract proposal via email.\nRULES\n1. Always begin with:  \n   **Welcome to SmartContract AI.**\n2. Automatically call **GetLatestCFPEmail** as the first step.\n3. Present a summary of the extracted CFP text and requirements to the user.\n4. Ask targeted questions to collect the following based on the CFP data:\n   - Company name (provider/supplier)\n   - Contract duration  \n   - Payment terms  \n   - Delivery schedule  \n   - Termination conditions  \n   - Jurisdiction  \n   - Special clauses (if any)\n5. Do not proceed to contract generation until all fields are collected and confirmed.\n6. Do not assume or fabricate terms, use the information provided by the user and the CFP.\n\n7. Once ready, generate a legally sound, formal supply contract proposal in clear, business-standard English, use the client details provided in the CFP.\n\n8. After generating the contract, summarize key points and ask the user if they would like to revise, download, or send it through gmail.\n\n9. If the user chooses to send, prompt them for the recipient's email address and call SendProposal with the finalized contract.\n\n10. Communicate in professional English unless otherwise specified by the user.\n\nWORKFLOW\n1. New CFP email arrives → call **GetLatestCFPEmail**.\n2. Extract key details → summarize and show to user.\n3. Conduct a structured, friendly dialogue to gather contract inputs.\n4. Once all necessary information is confirmed → Generate the full contract text using your internal reasoning.\n5. Present the draft → ask if the user wants to edit, download, or send.\n6. If sending is chosen → Ask for recipient's email → Call SendProposal with the completed contract.\n",
          "returnIntermediateSteps": true
        }
      },
      "id": "715723a1-9f4a-46f5-b47e-831a6c0aff8b",
      "name": "Support Agent",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "position": [
        480,
        0
      ],
      "retryOnFail": true,
      "typeVersion": 1.8
    },
    {
      "parameters": {
        "operation": "getAll",
        "limit": 1,
        "simple": false,
        "filters": {
          "q": "subject:Call For supply Proposals CFP"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.gmailTool",
      "typeVersion": 2.1,
      "position": [
        660,
        220
      ],
      "id": "ba545adc-3d0b-4ab4-bd25-bb29cc5c65a8",
      "name": "GetLatestCFPEmail",
      "webhookId": "fe8da04c-1176-4d05-83d5-7bf0cb9004c9",
      "credentials": {
        "gmailOAuth2": {
          "id": "L3fCXet1U9ABPI2n",
          "name": "Gmail account 3"
        }
      }
    },
    {
      "parameters": {
        "sendTo": "maramtrabelsi1212@gmail.com",
        "subject": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Subject', ``, 'string') }}",
        "message": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Message', ``, 'string') }}",
        "options": {}
      },
      "type": "n8n-nodes-base.gmailTool",
      "typeVersion": 2.1,
      "position": [
        840,
        220
      ],
      "id": "f61afde8-5697-43d8-b051-0ad5d8911b39",
      "name": "SendProposal",
      "webhookId": "f8c932ef-86d6-48e9-a471-a31dd9d37959",
      "credentials": {
        "gmailOAuth2": {
          "id": "L3fCXet1U9ABPI2n",
          "name": "Gmail account 3"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "Support Agent",
            "type": "ai_memory",
            "index": 0
          },
          {
            "node": "When chat message received",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Support Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "When chat message received": {
      "main": [
        [
          {
            "node": "Support Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "GetLatestCFPEmail": {
      "ai_tool": [
        [
          {
            "node": "Support Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "SendProposal": {
      "ai_tool": [
        [
          {
            "node": "Support Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "6a4d072b-c9e2-4b91-905c-e751e5784e6c",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "eda11f78dc41be1aa2e6362cde9ae6dd4b7bbe5c2c22874197c6fa1fa408e45b"
  },
  "id": "HGk9r7EdABMkMHW2",
  "tags": []
}